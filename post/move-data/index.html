<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>move-data - ticks blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="ticks" /><meta name="description" content="数据定义 data section 数据段(data section)是最通常的定义数据的地方. 定义了数据内存中的存储位置, 可以在指令中引用, 修改 由 .data 伪指令声明. 该 section" />






<meta name="generator" content="Hugo 0.80.0 with theme even" />


<link rel="canonical" href="https://tickscn.github.io/post/move-data/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.c7bc1becf36bcf6a9ebd25d2947e43a2eb745ddb0c9a32b43126fd7fa460c351.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="move-data" />
<meta property="og:description" content="数据定义 data section 数据段(data section)是最通常的定义数据的地方. 定义了数据内存中的存储位置, 可以在指令中引用, 修改 由 .data 伪指令声明. 该 section" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tickscn.github.io/post/move-data/" />
<meta property="article:published_time" content="2019-12-01T16:18:37+00:00" />
<meta property="article:modified_time" content="2019-12-01T16:18:37+00:00" />
<meta itemprop="name" content="move-data">
<meta itemprop="description" content="数据定义 data section 数据段(data section)是最通常的定义数据的地方. 定义了数据内存中的存储位置, 可以在指令中引用, 修改 由 .data 伪指令声明. 该 section">
<meta itemprop="datePublished" content="2019-12-01T16:18:37+00:00" />
<meta itemprop="dateModified" content="2019-12-01T16:18:37+00:00" />
<meta itemprop="wordCount" content="1696">



<meta itemprop="keywords" content="汇编,assembly,CS," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="move-data"/>
<meta name="twitter:description" content="数据定义 data section 数据段(data section)是最通常的定义数据的地方. 定义了数据内存中的存储位置, 可以在指令中引用, 修改 由 .data 伪指令声明. 该 section"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">ticks blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">ticks blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">move-data</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-12-01 </span>
        <div class="post-category">
            <a href="/categories/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/"> 汇编语言 </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#数据定义">数据定义</a>
      <ul>
        <li><a href="#data-section">data section</a>
          <ul>
            <li><a href="#静态符号static-symbols">静态符号(static symbols)</a></li>
          </ul>
        </li>
        <li><a href="#bss-section">bss section</a></li>
      </ul>
    </li>
    <li><a href="#数据移动">数据移动</a>
      <ul>
        <li><a href="#mov-格式">mov 格式</a></li>
        <li><a href="#内存与寄存器数据移动">内存与寄存器数据移动</a>
          <ul>
            <li><a href="#使用建立索引的内存">使用建立索引的内存</a></li>
            <li><a href="#使用间接地址">使用间接地址</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#条件转移">条件转移</a>
      <ul>
        <li><a href="#cmov">CMOV</a></li>
      </ul>
    </li>
    <li><a href="#交换数据">交换数据</a>
      <ul>
        <li><a href="#数据交换指令">数据交换指令</a>
          <ul>
            <li><a href="#xchg">XCHG</a></li>
            <li><a href="#bswap">BSWAP</a></li>
            <li><a href="#冒泡排序">冒泡排序</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h1 id="数据定义">数据定义</h1>
<h2 id="data-section">data section</h2>
<p>数据段(data section)是最通常的定义数据的地方. 定义了数据内存中的存储位置, 可以在指令中引用, 修改</p>
<p>由 .data 伪指令声明. 该 section 的数据元素会预分配空间, 在程序中可读写</p>
<blockquote>
<p>.rodata 与 .data类似, 只不过 .rodata 中的数据在程序中是只读的</p>
</blockquote>
<p>定义变量需要 label 和伪指令. label 类似于c语言中的变量名, 是程序引用的一个标记. 伪指令分配空间的大小</p>
<p>默认值是必须的</p>
<table>
<thead>
<tr>
<th style="text-align:center">伪指令</th>
<th style="text-align:center">数据类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">.ascii</td>
<td style="text-align:center">字符</td>
</tr>
<tr>
<td style="text-align:center">.asciz</td>
<td style="text-align:center">以 &lsquo;\0&rsquo; 结尾的字符串</td>
</tr>
<tr>
<td style="text-align:center">.byte</td>
<td style="text-align:center">比特</td>
</tr>
<tr>
<td style="text-align:center">.double</td>
<td style="text-align:center">双精度浮点</td>
</tr>
<tr>
<td style="text-align:center">.float</td>
<td style="text-align:center">单精度浮点</td>
</tr>
<tr>
<td style="text-align:center">.single</td>
<td style="text-align:center">与 float 相同</td>
</tr>
<tr>
<td style="text-align:center">.short</td>
<td style="text-align:center">16-bit</td>
</tr>
<tr>
<td style="text-align:center">.int</td>
<td style="text-align:center">32-bit 整型</td>
</tr>
<tr>
<td style="text-align:center">.long</td>
<td style="text-align:center">与 .int 相同</td>
</tr>
<tr>
<td style="text-align:center">.quad</td>
<td style="text-align:center">8-byte(64-bit) 整形</td>
</tr>
<tr>
<td style="text-align:center">.octa</td>
<td style="text-align:center">16-byte(128-bit) 整型</td>
</tr>
</tbody>
</table>
<p>每一个 label 后面并不一定只定义一个数据. 数据连续存储</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="nl">array:</span>
    <span class="na">.int</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span>
</code></pre></td></tr></table>
</div>
</div><p>引用时可以使用相对路径.比如说 100 位于 array, 150 位于 array+4, 250 位于 array+12</p>
<h3 id="静态符号static-symbols">静态符号(static symbols)</h3>
<p>使用 .equ 伪指令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.equ</span> <span class="no">LINUX_SYS_CALL</span> <span class="mi">0x80</span>
<span class="na">.equ</span> <span class="no">pi</span> <span class="mi">3</span><span class="no">.14159</span>
</code></pre></td></tr></table>
</div>
</div><p>设置后不可更改, 使用时需要加 &lsquo;$&rsquo; 符号</p>
<h2 id="bss-section">bss section</h2>
<p>没有声明数据类型, 只是分配了一段未初始化内存</p>
<p>| .comm  | 声明一段未初始化的内存区域     |
| .lcomm | 声明一段未初始化的局部内存区域 |</p>
<p>.lcomm 声明的区域只有局部的汇编代码可以访问</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.lcomm</span> <span class="no">buffer</span><span class="p">,</span> <span class="mi">1024</span>
</code></pre></td></tr></table>
</div>
</div><p>bss 内存是运行时分配, 而 data 的数据会直接写入可执行文件</p>
<h1 id="数据移动">数据移动</h1>
<h2 id="mov-格式">mov 格式</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">movx source, destination
</code></pre></td></tr></table>
</div>
</div><p>x 是定义数据大小
| b | 8-bit byte       |
| w | 16-bit word      |
| l | 32-bit long word |
| q | 64-bit quad word |</p>
<p>| source       | destination  |
| 立即数       | 通用寄存器   |
| 立即数       | 内存         |
| 通用寄存器   | 通用寄存器   |
| 通用寄存器   | 段寄存器     |
| 段寄存器     | 通用寄存器   |
| 控制寄存器   | 通用寄存器   |
| 通用寄存器   | Debug 寄存器 |
| Debug 寄存器 | 通用寄存器   |
| 内存         | 通用寄存器   |
| 内存         | 段寄存器     |
| 通用寄存器   | 内存         |
| 段寄存器     | 内存         |</p>
<h2 id="内存与寄存器数据移动">内存与寄存器数据移动</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="c"># movtest1.s
</span><span class="c"></span><span class="na">.section</span> <span class="no">.data</span>
<span class="nl">value:</span>
    <span class="na">.int</span> <span class="mi">1</span>
<span class="na">.section</span> <span class="no">.text</span>
<span class="na">.globl</span> <span class="no">_start</span>
<span class="nl">_start:</span>
    <span class="nf">nop</span>
    <span class="nf">movl</span> <span class="no">value</span><span class="p">,</span> <span class="nv">%eax</span>
    <span class="nf">movl</span> <span class="no">$100</span><span class="p">,</span> <span class="nv">%eax</span>
    <span class="nf">movl</span> <span class="nv">%eax</span><span class="p">,</span> <span class="no">value</span>
    <span class="nf">movl</span> <span class="no">$1</span><span class="p">,</span> <span class="nv">%eax</span>
    <span class="nf">movl</span> <span class="no">$0</span><span class="p">,</span> <span class="nv">%ebx</span>
    <span class="nf">int</span> <span class="no">$0x80</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="使用建立索引的内存">使用建立索引的内存</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="nf">value</span> <span class="no">.int</span> <span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">35</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">35</span><span class="p">,</span><span class="mi">50</span><span class="no">.55</span><span class="p">,</span><span class="mi">60</span>
</code></pre></td></tr></table>
</div>
</div><p>索引内存</p>
<ul>
<li>基址(base address)</li>
<li>偏置(offset)</li>
<li>数据大小(size of the data)</li>
<li>索引(index)</li>
</ul>
<p><strong>format</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">base_address(offset_addres, index, size)
</code></pre></td></tr></table>
</div>
</div><p>数据在</p>
<p>base_addres + offset_addres + index * size</p>
<p>0可以省略不写, 但是 &lsquo;,&rsquo; 号不能省</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.section</span> <span class="no">.data</span>
<span class="nl">output:</span>
    <span class="na">.asciz</span> <span class="s">&#34;The value is %d\n&#34;</span>
<span class="nl">values:</span>
    <span class="na">.int</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">60</span>
<span class="na">.section</span> <span class="no">.text</span>
<span class="na">.globl</span> <span class="no">_start</span>
<span class="nl">_start:</span>
  <span class="nf">movl</span> <span class="no">$0</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nl">loop:</span>
  <span class="nf">movl</span> <span class="no">values</span><span class="p">(,</span> <span class="nv">%ebx</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="nv">%esi</span>
  <span class="nf">movl</span> <span class="no">$output</span><span class="p">,</span> <span class="nv">%edi</span>
  <span class="nf">call</span> <span class="no">printf</span>
  <span class="nf">inc</span> <span class="nv">%ebx</span>
  <span class="nf">cmpl</span> <span class="no">$11</span><span class="p">,</span> <span class="nv">%ebx</span>
  <span class="nf">jne</span> <span class="no">loop</span>

  <span class="nf">movl</span> <span class="no">$0</span><span class="p">,</span> <span class="nv">%edi</span>
  <span class="nf">call</span> <span class="no">exit</span>

</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">$ as -o movtest.o movtest.s -gtabs
$ ld -I /lib/ld-linux-x86-64.so.2 -o movtest movtest1.o -lc
$ ./movtest
The value is 10
The value is 15
The value is 20
The value is 25
The value is 30
The value is 35
The value is 40
The value is 45
The value is 50
The value is 55
The value is 60
</code></pre></td></tr></table>
</div>
</div><h3 id="使用间接地址">使用间接地址</h3>
<p>使用指针</p>
<p>可以在label 前加入 &lsquo;$&rsquo; 符号获取数据地址.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">movl $value, %edi
</code></pre></td></tr></table>
</div>
</div><p>使用括号解引用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">movl %eax, (%edi)
</code></pre></td></tr></table>
</div>
</div><h1 id="条件转移">条件转移</h1>
<h2 id="cmov">CMOV</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">cmovx source, destination
</code></pre></td></tr></table>
</div>
</div><p>x指出判断用的条件</p>
<table>
<thead>
<tr>
<th style="text-align:center">EFLAGS bit</th>
<th style="text-align:center">名字</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CF</td>
<td style="text-align:center">进位标志位</td>
<td style="text-align:center">数学运算产生了进位或借位</td>
</tr>
<tr>
<td style="text-align:center">OF</td>
<td style="text-align:center">溢出标志位</td>
<td style="text-align:center">整型数据过大或过小</td>
</tr>
<tr>
<td style="text-align:center">PF</td>
<td style="text-align:center">校验标志柆</td>
<td style="text-align:center">运算正确的校验</td>
</tr>
<tr>
<td style="text-align:center">SF</td>
<td style="text-align:center">符号标志位</td>
<td style="text-align:center">结果的正负</td>
</tr>
<tr>
<td style="text-align:center">ZF</td>
<td style="text-align:center">零标志位</td>
<td style="text-align:center">结果是0</td>
</tr>
</tbody>
</table>
<p>无符号操作</p>
<table>
<thead>
<tr>
<th style="text-align:center">指令对</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">EFLAGS</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CMOVA/CMOVNBE</td>
<td style="text-align:left">above/not below or equal</td>
<td style="text-align:left">(CF or ZF) = 0</td>
</tr>
<tr>
<td style="text-align:center">CMOVAE/CMOVNB</td>
<td style="text-align:left">above or equal/ not below</td>
<td style="text-align:left">CF = 0</td>
</tr>
<tr>
<td style="text-align:center">CMOVNC</td>
<td style="text-align:left">not carry</td>
<td style="text-align:left">CF = 0</td>
</tr>
<tr>
<td style="text-align:center">CMOVB/CMOVNAE</td>
<td style="text-align:left">below/not above or equal</td>
<td style="text-align:left">CF = 1</td>
</tr>
<tr>
<td style="text-align:center">CMOVC</td>
<td style="text-align:left">carry</td>
<td style="text-align:left">CF = 1</td>
</tr>
<tr>
<td style="text-align:center">CMOVBE/CMOVNA</td>
<td style="text-align:left">below or equal/not above</td>
<td style="text-align:left">CF or ZF = 1</td>
</tr>
<tr>
<td style="text-align:center">CMOVE/CMOVZ</td>
<td style="text-align:left">equal/zero</td>
<td style="text-align:left">ZF = 1</td>
</tr>
<tr>
<td style="text-align:center">CMOVNE/CMOVZ</td>
<td style="text-align:left">not equal/not zero</td>
<td style="text-align:left">ZF = 0</td>
</tr>
<tr>
<td style="text-align:center">CMOVP/CMOVPE</td>
<td style="text-align:left">偶校验</td>
<td style="text-align:left">PF = 1</td>
</tr>
<tr>
<td style="text-align:center">CMOVNP/CMOVPO</td>
<td style="text-align:left">奇校验</td>
<td style="text-align:left">PF = 0</td>
</tr>
</tbody>
</table>
<p>有符号操作</p>
<table>
<thead>
<tr>
<th style="text-align:left">指令对</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">EFLAGS</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">CMOVGE/CMOVNL</td>
<td style="text-align:left">greater or equal/not less</td>
<td style="text-align:left">(SF xor OF) = 0</td>
</tr>
<tr>
<td style="text-align:left">CMOVL/CMOVNGE</td>
<td style="text-align:left">less/not greater or equal</td>
<td style="text-align:left">(SF xor OF) = 1</td>
</tr>
<tr>
<td style="text-align:left">CMOVLE/CMOVNG</td>
<td style="text-align:left">less or equal/not greater</td>
<td style="text-align:left">((SF xor OF) or ZF)=1</td>
</tr>
<tr>
<td style="text-align:left">CMOVO</td>
<td style="text-align:left">overflow</td>
<td style="text-align:left">OF = 1</td>
</tr>
<tr>
<td style="text-align:left">CMOVNO</td>
<td style="text-align:left">not overflow</td>
<td style="text-align:left">OF = 0</td>
</tr>
<tr>
<td style="text-align:left">CMOVS</td>
<td style="text-align:left">&lt;0</td>
<td style="text-align:left">SF = 1</td>
</tr>
<tr>
<td style="text-align:left">CMOVNS</td>
<td style="text-align:left">&gt;=0</td>
<td style="text-align:left">SF = 0</td>
</tr>
<tr>
<td style="text-align:left">使用之前需要先执行能够设置 EFLAGS 的语句</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>例: 最大值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="c"># maximum.s
</span><span class="c"></span><span class="na">.section</span> <span class="no">.data</span>
<span class="nl">output:</span>
    <span class="na">.asciz</span> <span class="s">&#34;The largest value is %d\n&#34;</span>
<span class="nl">values:</span>
    <span class="na">.int</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">400</span>
<span class="na">.section</span> <span class="no">.text</span>
<span class="na">.globl</span> <span class="no">_start</span>
<span class="nl">_start:</span>
    <span class="nf">nop</span>
	<span class="nf">movl</span> <span class="no">values</span><span class="p">,</span> <span class="nv">%esi</span>
	<span class="nf">movl</span> <span class="no">$1</span><span class="p">,</span>     <span class="nv">%ecx</span>
<span class="nl">loop:</span>
    <span class="nf">movl</span> <span class="no">values</span><span class="p">(,</span> <span class="nv">%ecx</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="nv">%eax</span>
    <span class="nf">cmp</span> <span class="nv">%esi</span><span class="p">,</span> <span class="nv">%eax</span>
	<span class="nf">cmova</span> <span class="nv">%eax</span><span class="p">,</span> <span class="nv">%esi</span>
	<span class="nf">inc</span> <span class="nv">%ecx</span>
	<span class="nf">cmp</span> <span class="no">$10</span><span class="p">,</span> <span class="nv">%ecx</span>
	<span class="nf">jne</span> <span class="no">loop</span>
	<span class="nf">movq</span> <span class="no">$output</span><span class="p">,</span> <span class="nv">%rdi</span>
	<span class="nf">call</span> <span class="no">printf</span>

	<span class="nf">movq</span> <span class="no">$0</span><span class="p">,</span> <span class="nv">%rdi</span>
	<span class="nf">call</span> <span class="no">exit</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ as -o maximum.o maximum.s
$ ld -I /lib/ld-linux-x86-64.so.2 -o maximum maximum.o -lc
$ ./maximum
The largest value is <span class="m">600</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="交换数据">交换数据</h1>
<p>普通</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">movl %eax, %ecx
movl %ebx, %eax
movl %ebx, %ecx
</code></pre></td></tr></table>
</div>
</div><p>需要三个指令, 一个额外的寄存器. 可以使用交换指令</p>
<h2 id="数据交换指令">数据交换指令</h2>
<table>
<thead>
<tr>
<th style="text-align:left">指令</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">XCHG</td>
<td style="text-align:left">交换两个寄存器或者寄存器与内存之间的数据</td>
</tr>
<tr>
<td style="text-align:left">BSWAP</td>
<td style="text-align:left">一个 32 位寄存器 byte 逆序</td>
</tr>
<tr>
<td style="text-align:left">XADD</td>
<td style="text-align:left">交换两个值并将和放入目标位置</td>
</tr>
<tr>
<td style="text-align:left">CMPXCHG</td>
<td style="text-align:left">比较并与另一个数交换</td>
</tr>
<tr>
<td style="text-align:left">CMPXCHG8B</td>
<td style="text-align:left">上个命令的 64-bit 版</td>
</tr>
</tbody>
</table>
<h3 id="xchg">XCHG</h3>
<p>交换两个寄存器或者寄存器与内存之间的数据. 两个操作数的数据位数应相同.
若其中一个是内存中的数据, 该指令会自动加锁(LOCK), 在交换过程中拒绝其它指令访问该内存</p>
<h3 id="bswap">BSWAP</h3>
<p>逆序的是byte, 不是bit</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="c"># bswap.s
</span><span class="c"></span><span class="na">.section</span> <span class="no">.data</span>
<span class="nl">output:</span>
    <span class="na">.asciz</span> <span class="s">&#34;0x%x\n&#34;</span>
<span class="na">.section</span> <span class="no">.text</span>
<span class="na">.globl</span> <span class="no">_start</span>
<span class="nl">_start:</span>
    <span class="nf">movl</span> <span class="no">$0x12345678</span><span class="p">,</span> <span class="nv">%esi</span>
	<span class="nf">bswap</span> <span class="nv">%esi</span>
	<span class="nf">movq</span> <span class="no">$output</span><span class="p">,</span> <span class="nv">%rdi</span>
	<span class="nf">call</span> <span class="no">printf</span>

	<span class="nf">movq</span> <span class="no">$0</span><span class="p">,</span> <span class="nv">%rdi</span>
	<span class="nf">call</span> <span class="no">exit</span>
</code></pre></td></tr></table>
</div>
</div><p>result: 0x78563412</p>
<h3 id="冒泡排序">冒泡排序</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="c"># bubble.s
</span><span class="c"></span><span class="na">.section</span> <span class="no">.data</span>
<span class="nl">values:</span>
  <span class="na">.int</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span>
  <span class="nf">size</span> <span class="err">=</span> <span class="p">(.</span> <span class="p">-</span> <span class="no">values</span><span class="p">)</span> <span class="err">/</span> <span class="mi">4</span>
<span class="na">.section</span> <span class="no">.text</span>
<span class="na">.globl</span> <span class="no">_start</span>
<span class="nl">_start:</span>
  <span class="nf">movl</span> <span class="no">$size</span><span class="p">,</span> <span class="nv">%r8d</span>
  <span class="nf">movl</span> <span class="no">$size</span><span class="p">,</span> <span class="nv">%r9d</span>
  <span class="nf">movq</span> <span class="no">$values</span><span class="p">,</span> <span class="nv">%rsi</span>
  <span class="nf">jmp</span> <span class="no">skip</span>
<span class="nl">loop:</span>
  <span class="nf">movl</span> <span class="p">-</span><span class="mi">4</span><span class="p">(</span><span class="nv">%rsi</span><span class="p">),</span> <span class="nv">%eax</span>
  <span class="nf">cmp</span> <span class="nv">%eax</span><span class="p">,</span> <span class="p">(</span><span class="nv">%rsi</span><span class="p">)</span>
  <span class="nf">jge</span> <span class="no">skip</span>
  <span class="nf">xchg</span> <span class="nv">%eax</span><span class="p">,</span> <span class="p">(</span><span class="nv">%rsi</span><span class="p">)</span>
  <span class="nf">movl</span> <span class="nv">%eax</span><span class="p">,</span> <span class="p">-</span><span class="mi">4</span><span class="p">(</span><span class="nv">%rsi</span><span class="p">)</span>
<span class="nl">skip:</span>
  <span class="nf">addq</span> <span class="no">$4</span><span class="p">,</span> <span class="nv">%rsi</span>
  <span class="nf">dec</span> <span class="nv">%r9d</span>
  <span class="nf">jnz</span> <span class="no">loop</span>
  <span class="nf">dec</span> <span class="nv">%r8d</span>
  <span class="nf">jz</span> <span class="no">end</span>
  <span class="nf">movq</span> <span class="no">$values</span><span class="p">,</span> <span class="nv">%rsi</span>
  <span class="nf">movl</span> <span class="nv">%r8d</span><span class="p">,</span> <span class="nv">%r9d</span>
  <span class="nf">jmp</span> <span class="no">loop</span>

<span class="nl">end:</span>
  <span class="nf">movl</span> <span class="no">$1</span><span class="p">,</span> <span class="nv">%eax</span>
  <span class="nf">movl</span> <span class="no">$0</span><span class="p">,</span> <span class="nv">%ebx</span>
  <span class="nf">int</span> <span class="mi">0x80</span>
</code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">ticks</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2019-12-01
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E6%B1%87%E7%BC%96/">汇编</a>
          <a href="/tags/assembly/">assembly</a>
          <a href="/tags/cs/">CS</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">多线程</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/simple-assembly-program/">
            <span class="next-text nav-default">simple-assembly-program</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var gitalk = new Gitalk({
        id: '2019-12-01 16:18:37 \u002b0000 UTC',
        title: 'move-data',
        clientID: 'ea0e3eccad5c469abf15',
        clientSecret: 'f80a60df515da91e6c9b53c0bede3227ebe2f8ce',
        repo: 'tickscn.github.io',
        owner: 'tickscn',
        admin: ['tickscn'],
        body: decodeURI(location.href)
      });
      gitalk.render('gitalk-container');
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by gitalk.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:xiehuiwu1996@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/tickscn/" class="iconfont icon-github" title="github"></a>
  <a href="https://tickscn.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2019 - 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>ticks</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
